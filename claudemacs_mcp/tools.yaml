# Claudemacs MCP Tool Definitions
# Each tool maps to an elisp function that will be called via emacsclient
#
# Flags:
#   safe: true  - Tool will be auto-approved (no permission prompt)
#                 Use for read-only operations and notes tools

tools:
  # Buffer reading operations (safe - read only)
  get_buffer_content:
    description: "Get the content of an Emacs buffer. Can optionally get head/tail lines or a specific line range."
    elisp: claudemacs-ai-get-buffer-content
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer (e.g. 'main.py', '*scratch*')"
        required: true
      tail_lines:
        type: integer
        description: "Optional: get only the last N lines"
      head_lines:
        type: integer
        description: "Optional: get only the first N lines"
      start_line:
        type: integer
        description: "Optional: start line for range (1-indexed, requires end_line)"
      end_line:
        type: integer
        description: "Optional: end line for range (1-indexed, inclusive, requires start_line)"

  list_buffers:
    description: "List all open buffers in Emacs."
    elisp: claudemacs-ai-list-buffers
    safe: true

  clear_buffer:
    description: "Clear the terminal content in a claudemacs buffer. Useful when the buffer gets too large and causing performance issues."
    elisp: claudemacs-ai-clear-buffer
    safe: false
    args:
      buffer_name:
        type: string
        description: "Name of the claudemacs buffer to clear"
        required: true

  buffer_info:
    description: "Get detailed information about a buffer (file path, size, major mode, cursor position, etc.)."
    elisp: claudemacs-ai-buffer-info
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true

  search_buffer:
    description: "Search for a pattern in a buffer and return matches with context lines (similar to grep). Supports regex patterns and context control."
    elisp: claudemacs-ai-search-buffer
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer to search"
        required: true
      pattern:
        type: string
        description: "Regular expression pattern to search for"
        required: true
      context_before:
        type: integer
        description: "Number of lines to show before each match (like grep -B)"
      context_after:
        type: integer
        description: "Number of lines to show after each match (like grep -A)"
      case_insensitive:
        type: boolean
        description: "If true, ignore case when searching (like grep -i)"
      limit:
        type: integer
        description: "Maximum number of matches to return"

  get_region:
    description: "Get content from a specific region in a buffer by character positions."
    elisp: claudemacs-ai-get-region
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      start:
        type: integer
        description: "Start position (1-indexed)"
        required: true
      end:
        type: integer
        description: "End position (1-indexed)"
        required: true

  # Magit section querying (for buffers using magit-section)
  magit_section_query_find:
    description: "Find magit sections in a buffer matching criteria. Returns list of positions."
    elisp: claudemacs-ai-magit-section-query-find
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      type:
        type: string
        description: "Section type symbol to match (e.g., 'timeout-section')"
      heading:
        type: string
        description: "Regex pattern to match section heading"
      hidden:
        type: boolean
        description: "Whether section should be hidden"
      value:
        type: string
        description: "Section value to match"

  magit_section_query_content:
    description: "Extract content of a magit section at a given position."
    elisp: claudemacs-ai-magit-section-query-content
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      section_position:
        type: integer
        description: "Buffer position within the section"
        required: true
      strip_indent:
        type: boolean
        description: "If true, remove common leading whitespace"

  magit_section_query_get:
    description: "Get metadata for a magit section at a given position. Returns (type heading hidden start end [content])."
    elisp: claudemacs-ai-magit-section-query-get
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      section_position:
        type: integer
        description: "Buffer position within the section"
        required: true
      include_content:
        type: boolean
        description: "If true, include section content in result"

  magit_section_query_children:
    description: "Get child sections of a section matching criteria. Returns list of positions."
    elisp: claudemacs-ai-magit-section-query-children
    safe: true
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      section_position:
        type: integer
        description: "Buffer position within the parent section"
        required: true
      type:
        type: string
        description: "Child section type symbol to match"
      heading:
        type: string
        description: "Regex pattern to match child heading"
      hidden:
        type: boolean
        description: "Whether child section should be hidden"
      value:
        type: string
        description: "Child section value to match"

  # Buffer modification operations
  insert_in_buffer:
    description: "[WRITE] Insert text into a buffer at the current point position."
    elisp: claudemacs-ai-insert-in-buffer
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      text:
        type: string
        description: "Text to insert"
        required: true

  replace_region:
    description: "[WRITE] Replace content in a specific region of a buffer."
    elisp: claudemacs-ai-replace-region
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      start:
        type: integer
        description: "Start position (1-indexed)"
        required: true
      end:
        type: integer
        description: "End position (1-indexed)"
        required: true
      text:
        type: string
        description: "Replacement text"
        required: true

  goto_point:
    description: "[WRITE] Move the cursor (point) to a specific position in a buffer."
    elisp: claudemacs-ai-goto-point
    args:
      buffer_name:
        type: string
        description: "Name of the buffer"
        required: true
      position:
        type: integer
        description: "Position to move to (1-indexed)"
        required: true

  # REPL/Terminal operations
  send_input:
    description: "[EXECUTE] Send input to a REPL buffer (works with eat, comint, eshell)."
    elisp: claudemacs-ai-send-input
    args:
      buffer_name:
        type: string
        description: "Name of the REPL buffer (e.g. '*Python*', '*eshell*')"
        required: true
      text:
        type: string
        description: "Text/command to send"
        required: true

  exec_in_terminal:
    description: "[EXECUTE] Execute a shell command in an eat terminal buffer and wait for completion."
    elisp: claudemacs-ai-exec-in-eat-terminal
    args:
      buffer_name:
        type: string
        description: "Name of the eat terminal buffer"
        required: true
      command:
        type: string
        description: "Shell command to execute"
        required: true
      timeout:
        type: integer
        description: "Timeout in seconds (default: 30)"

  # NOTE: watch_buffer, watch_for_pattern, and send_and_watch are implemented
  # as native async Python tools in server.py (not elisp) to avoid blocking Emacs.
  # They poll via emacsclient asynchronously.

  # Notes operations (all safe - persisted org-mode file at .claude/claudemacs-notes.org)
  get_notes:
    description: "Get the content of the notes file (org-mode format, persisted to .claude/claudemacs-notes.org)."
    elisp: claudemacs-ai-get-notes
    safe: true

  set_notes:
    description: "Set the notes file content (org-mode format), replacing any existing content."
    elisp: claudemacs-ai-set-notes
    safe: true
    args:
      content:
        type: string
        description: "Content to store in notes (org-mode format)"
        required: true

  append_notes:
    description: "Append content to the notes file (org-mode format) without replacing existing content."
    elisp: claudemacs-ai-append-notes
    safe: true
    args:
      content:
        type: string
        description: "Content to append to notes (org-mode format)"
        required: true

  clear_notes:
    description: "Clear all content from the notes file."
    elisp: claudemacs-ai-clear-notes
    safe: true

  # Session management
  restart_and_resume:
    description: "Restart the claudemacs session and resume the conversation."
    elisp: claudemacs-ai-restart-and-resume
    safe: true

  # Agent coordination - spawn and communicate with other Claude agents
  spawn_agent:
    description: "Spawn a new Claude agent in a directory. Returns the buffer name for monitoring. Note: To send an initial message to the agent after spawning, use message_agent separately (TODO: MCP server will handle this automatically)."
    elisp: claudemacs-spawn-agent
    args:
      directory:
        type: string
        description: "Directory path where the agent should work (will be expanded)"
        required: true
      agent_name:
        type: string
        description: "Optional identifier for the agent (e.g., 'test', 'debug'). If not provided, buffer will be named *claudemacs:/path*. If provided, buffer will be *claudemacs:/path:agent-name*."

  list_agents:
    description: "List all running claudemacs agent sessions. Returns (buffer-name, directory) pairs."
    elisp: claudemacs-ai-list-agents
    safe: true

  agent_ready_p:
    description: "Check if an agent is ready to receive messages (has prompt visible, not busy thinking)."
    elisp: claudemacs-ai-agent-ready-p
    safe: true
    args:
      buffer_name:
        type: string
        description: "Buffer name of the agent to check"
        required: true

  message_agent:
    description: "Queue a message to another running agent. The MCP server will deliver it when the agent is ready."
    elisp: claudemacs-ai-message-agent
    args:
      buffer_name:
        type: string
        description: "Buffer name of the agent (from list_agents or spawn_agent)"
        required: true
      message:
        type: string
        description: "Message to send as user input to the agent"
        required: true

  # Generic elisp evaluation
  eval_elisp:
    description: "Evaluate arbitrary Emacs Lisp expression. Returns the result."
    elisp: eval
    args:
      expression:
        type: string
        description: "The elisp expression to evaluate"
        required: true

  # Org-mode notes operations (all safe - persisted to .claude/claudemacs-notes.org)
  notes_add_heading:
    description: "Add an org heading to the notes file. Use this to organize notes and context."
    elisp: claudemacs-ai-notes-add-heading
    safe: true
    args:
      level:
        type: integer
        description: "Heading level (1-6, where 1 is top-level)"
        required: true
      title:
        type: string
        description: "The heading title"
        required: true

  notes_add_todo:
    description: "Add a TODO item to the notes file. Great for tracking tasks."
    elisp: claudemacs-ai-notes-add-todo
    safe: true
    args:
      level:
        type: integer
        description: "Heading level (1-6)"
        required: true
      title:
        type: string
        description: "The TODO title"
        required: true
      priority:
        type: string
        description: "Priority A, B, or C (optional)"

  notes_set_todo_state:
    description: "Set the TODO state of heading at point. Use after goto_heading."
    elisp: claudemacs-ai-notes-set-todo-state
    safe: true
    args:
      state:
        type: string
        description: "TODO, DONE, or empty string to clear"
        required: true

  notes_add_timestamp:
    description: "Add current timestamp to notes file."
    elisp: claudemacs-ai-notes-add-timestamp
    safe: true
    args:
      inactive:
        type: boolean
        description: "If true, use inactive [timestamp] instead of active <timestamp>"

  notes_get_headings:
    description: "Get all headings from notes file as structured list of (level, title, todo-state)."
    elisp: claudemacs-ai-notes-get-headings
    safe: true

  notes_goto_heading:
    description: "Move point to a heading by title. Use before toggle/set operations."
    elisp: claudemacs-ai-notes-goto-heading
    safe: true
    args:
      title:
        type: string
        description: "The heading title to find"
        required: true

  notes_add_list_item:
    description: "Add a list item to notes file. Can include checkbox for task lists."
    elisp: claudemacs-ai-notes-add-list-item
    safe: true
    args:
      text:
        type: string
        description: "The list item text"
        required: true
      checkbox:
        type: boolean
        description: "If true, add a checkbox [ ]"

  notes_toggle_checkbox:
    description: "Toggle checkbox at current position in notes file."
    elisp: claudemacs-ai-notes-toggle-checkbox
    safe: true

  notes_schedule:
    description: "Add SCHEDULED timestamp to heading at point. Use after goto_heading."
    elisp: claudemacs-ai-notes-schedule
    safe: true
    args:
      timestamp:
        type: string
        description: "Org timestamp like '<2024-01-15 Mon>' or relative like '+1d', '+1w'"
        required: true

  notes_deadline:
    description: "Add DEADLINE timestamp to heading at point. Use after goto_heading."
    elisp: claudemacs-ai-notes-deadline
    safe: true
    args:
      timestamp:
        type: string
        description: "Org timestamp like '<2024-01-15 Mon>' or relative like '+1d', '+1w'"
        required: true

  notes_set_property:
    description: "Set a property on heading at point. Use after goto_heading."
    elisp: claudemacs-ai-notes-set-property
    safe: true
    args:
      property:
        type: string
        description: "Property name (e.g., 'URL', 'CATEGORY')"
        required: true
      value:
        type: string
        description: "Property value"
        required: true

  notes_get_property:
    description: "Get a property value from heading at point."
    elisp: claudemacs-ai-notes-get-property
    safe: true
    args:
      property:
        type: string
        description: "Property name to retrieve"
        required: true

  notes_set_tags:
    description: "Set tags on heading at point. Use after goto_heading."
    elisp: claudemacs-ai-notes-set-tags
    safe: true
    args:
      tags:
        type: string
        description: "Colon-separated tags like ':work:urgent:' or 'work:urgent'"
        required: true

  notes_clock_in:
    description: "Start time tracking on heading at point."
    elisp: claudemacs-ai-notes-clock-in
    safe: true

  notes_clock_out:
    description: "Stop time tracking."
    elisp: claudemacs-ai-notes-clock-out
    safe: true

  notes_set_effort:
    description: "Set effort estimate on heading at point."
    elisp: claudemacs-ai-notes-set-effort
    safe: true
    args:
      effort:
        type: string
        description: "Effort like '1:30' for 1h30m, or '30' for 30 minutes"
        required: true

  notes_archive_subtree:
    description: "Archive the subtree at point (moves to archive file)."
    elisp: claudemacs-ai-notes-archive-subtree
    safe: true

  notes_insert_link:
    description: "Insert an org link at point-max."
    elisp: claudemacs-ai-notes-insert-link
    safe: true
    args:
      url:
        type: string
        description: "The URL or link target"
        required: true
      description:
        type: string
        description: "Optional link description text"

  notes_sparse_tree:
    description: "Show only headings matching a query (tags, properties)."
    elisp: claudemacs-ai-notes-sparse-tree
    safe: true
    args:
      query:
        type: string
        description: "Match query like '+work-urgent' or 'PRIORITY=\"A\"'"
        required: true

  notes_promote:
    description: "Promote heading at point (decrease level, e.g., ** -> *)."
    elisp: claudemacs-ai-notes-promote
    safe: true

  notes_demote:
    description: "Demote heading at point (increase level, e.g., * -> **)."
    elisp: claudemacs-ai-notes-demote
    safe: true

  notes_move_up:
    description: "Move subtree at point up (swap with previous sibling)."
    elisp: claudemacs-ai-notes-move-up
    safe: true

  notes_move_down:
    description: "Move subtree at point down (swap with next sibling)."
    elisp: claudemacs-ai-notes-move-down
    safe: true

  # Priority 1: Properties and Structure
  notes_get_all_properties:
    description: "Get all properties for heading at point as an alist."
    elisp: claudemacs-ai-notes-get-all-properties
    safe: true

  notes_delete_property:
    description: "Delete a property from heading at point."
    elisp: claudemacs-ai-notes-delete-property
    safe: true
    args:
      property:
        type: string
        description: "Property name to delete"
        required: true

  notes_refile:
    description: "Refile (move) subtree at point to under another heading."
    elisp: claudemacs-ai-notes-refile
    safe: true
    args:
      target_heading:
        type: string
        description: "Title of heading to refile under"
        required: true

  notes_sort:
    description: "Sort children of current heading."
    elisp: claudemacs-ai-notes-sort
    safe: true
    args:
      sorting_type:
        type: string
        description: "Sort type: alpha, num, time, priority, todo (default: alpha)"

  # Priority 2: Navigation
  notes_up_heading:
    description: "Move to parent heading in notes file."
    elisp: claudemacs-ai-notes-up-heading
    safe: true

  notes_next_heading:
    description: "Move to next heading at same level."
    elisp: claudemacs-ai-notes-next-heading
    safe: true

  notes_prev_heading:
    description: "Move to previous heading at same level."
    elisp: claudemacs-ai-notes-prev-heading
    safe: true

  # Priority 3: Search
  notes_occur:
    description: "Search for regex pattern in notes file. Returns matches with positions."
    elisp: claudemacs-ai-notes-occur
    safe: true
    args:
      regexp:
        type: string
        description: "Regular expression to search for"
        required: true

  notes_get_tags:
    description: "Get tags for heading at point."
    elisp: claudemacs-ai-notes-get-tags
    safe: true

  # Priority 4: Clipboard
  notes_cut_subtree:
    description: "Cut (kill) subtree at point. Stored for later pasting."
    elisp: claudemacs-ai-notes-cut-subtree
    safe: true

  notes_copy_subtree:
    description: "Copy subtree at point. Stored for later pasting."
    elisp: claudemacs-ai-notes-copy-subtree
    safe: true

  notes_paste_subtree:
    description: "Paste subtree from clipboard at point."
    elisp: claudemacs-ai-notes-paste-subtree
    safe: true
    args:
      level:
        type: integer
        description: "Optional heading level for pasted subtree"

  # Inspection tools
  notes_get_heading_at_point:
    description: "Get detailed info about heading at point (level, title, todo, tags, priority, pos)."
    elisp: claudemacs-ai-notes-get-heading-at-point
    safe: true

  notes_get_subtree:
    description: "Get the full text content of subtree at point."
    elisp: claudemacs-ai-notes-get-subtree
    safe: true

  notes_get_children:
    description: "Get direct children headings of current heading (not grandchildren)."
    elisp: claudemacs-ai-notes-get-children
    safe: true

  # Elisp debugging and formatting tools
  elisp_check_parens:
    description: "Check an elisp file for unbalanced parentheses. Analyzes top-level forms and reports which ones have errors with line numbers."
    elisp: claudemacs-ai-elisp-check-parens
    safe: true
    args:
      file_path:
        type: string
        description: "Path to the elisp file to check"
        required: true

  elisp_format:
    description: "Format an elisp file using elisp-format if available. Returns formatted content or error if elisp-format is not installed."
    elisp: claudemacs-ai-elisp-format
    safe: true
    args:
      file_path:
        type: string
        description: "Path to the elisp file to format"
        required: true

  test_dynamic:
    description: "A test tool added dynamically during runtime"
    elisp: test-dynamic-tool
    safe: true
